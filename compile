#!/bin/bash

SIZES=(512 1024 2048 4096)
POLYBENCH=( "2DCONV" "3DCONV" "ATAX" "BICG" "2MM" "3MM" )

build_cpu () {
    for kernel in "${POLYBENCH[@]}"
    do
        for size in "${SIZES[@]}"
        do
            BENCH_NAME=Polybench/${kernel} SIZE=${size} RUNS=3 make compile-cpu
        done
    done
}

build_omp_cpu () {
    for kernel in "${POLYBENCH[@]}"
    do
        for size in "${SIZES[@]}"
        do
            BENCH_NAME=Polybench/${kernel} SIZE=${size} RUNS=3 make compile-omp-cpu
        done
    done
}

build_omp_gpu () {
    for kernel in "${POLYBENCH[@]}"
    do
        for size in "${SIZES[@]}"
        do
            BENCH_NAME=Polybench/${kernel} SIZE=${size} RUNS=3 make compile-omp-gpu
        done
    done
}

benchmark_cpu () {
    for kernel in "${POLYBENCH[@]}"
    do
        for size in "${SIZES[@]}"
        do
            BENCH_NAME=Polybench/${kernel} SIZE=${size} RUNS=3 make run-cpu
        done
    done
}

benchmark_omp_cpu () {
    for kernel in "${POLYBENCH[@]}"
    do
        for size in "${SIZES[@]}"
        do
            BENCH_NAME=Polybench/${kernel} SIZE=${size} RUNS=3 make run-omp-cpu
        done
    done
}

benchmark_omp_gpu () {
    for kernel in "${POLYBENCH[@]}"
    do
        for size in "${SIZES[@]}"
        do
            BENCH_NAME=Polybench/${kernel} SIZE=${size} RUNS=3 make run-omp-gpu
        done
    done
}

llvm_mca () {
    for kernel in "${POLYBENCH[@]}"
    do
        BENCH_NAME=Polybench/${kernel} make llvm-mca
    done
}

test_all() {
    for kernel in "${POLYBENCH[@]}"
    do
        BENCH_NAME=Polybench/${kernel} make test
    done
}

# usage: ./compile test 2DCONV
test() {
    kernel="$1"
    BENCH_NAME=Polybench/${kernel} make test
}

"$@"
